import{u as e,g as t,j as n,i as r,a as s,b as a,e as o,c as l,d as i,f as c,h as u,k as d,l as f,m,n as y,o as p,p as v,I as h,q as g,r as x,s as w,U as b,t as j,v as E,w as k,x as $,y as L,C as I}from"./useAntiCache-DZsWjpwk.js";import{r as S,R as T}from"./react-vendor-Bz3rmKJE.js";function R({embedUrl:r,width:s,height:a,scale:o,offsetX:l,offsetY:i,align:c,fit:u}){const d=e(),f=16/9;let m,y,p,v;if("fill"===u)m=s,y=a,p=s,v=a;else if("contain"===u){s/a>f?(y=a,m=a*f):(m=s,y=s/f),p=m,v=y}else{s/a>f?(m=s,y=s/f):(y=a,m=a*f),p=m,v=y}const h=t(c),g={position:"absolute",top:0,left:0,width:`${m}px`,height:`${y}px`,overflow:"hidden",transform:`translate(${h.x/100*s-m/2+l}px, ${h.y/100*a-y/2+i}px) scale(${o})`,transformOrigin:"center center"},x={width:`${p}px`,height:`${v}px`,border:"none",pointerEvents:"none",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",transformOrigin:"center center"};return n.jsx("div",{className:"yt-wrapper",style:g,children:n.jsx("iframe",{src:r,className:"yt-frame",style:x,allow:"autoplay; encrypted-media",allowFullScreen:!1,title:d("mediaYoutubeBackgroundTitle")})})}function U({url:t,settings:c,className:u,style:d,sourceType:f,localKind:m}){const y=e(),p=S.useRef(null),v="local"===f&&"video"===m||r(t),h=s(c.align,c.x,c.y),g={width:"100%",height:"100%",objectFit:c.fit,objectPosition:h,transform:`scale(${c.scale})`,transformOrigin:"center center",display:"block",...d};if(S.useEffect(()=>{if(!v||!p.current)return;const e=p.current,t=async()=>{if(e&&(e.paused||e.ended))try{c.loop&&e.ended&&(e.currentTime=0),await e.play()}catch{}},n=()=>{c.loop&&(e.currentTime=0,t())},r=()=>{c.autoplay&&!e.ended&&setTimeout(t,100)},s=()=>{c.autoplay&&t()},a=()=>{!document.hidden&&c.autoplay&&t()};e.addEventListener("ended",n),e.addEventListener("pause",r),e.addEventListener("loadeddata",s),document.addEventListener("visibilitychange",a);const o=setInterval(()=>{c.autoplay&&c.loop&&t()},2e3);return t(),()=>{e.removeEventListener("ended",n),e.removeEventListener("pause",r),e.removeEventListener("loadeddata",s),document.removeEventListener("visibilitychange",a),clearInterval(o)}},[v,c.autoplay,c.loop,t]),!t)return null;if("youtube"===a(t)){const e=o(t);if(e){const t=l(e),{width:r,height:s}=i();return n.jsx(R,{embedUrl:t,width:r,height:s,scale:c.scale,offsetX:c.x,offsetY:c.y,align:c.align,fit:c.fit})}}return v?n.jsx("video",{ref:p,src:t,autoPlay:c.autoplay,loop:c.loop,muted:c.mute,playsInline:!0,className:u,style:g}):n.jsx("img",{src:t,alt:y("mediaAltGeneric"),className:u,style:g})}const A="_krakenOverlay_arrfa_1";function N(){const{settings:e}=c(),{mediaUrl:t}=u(),r=d(),s=f(),a=m({settings:e,activePresetId:s}),o=y(s),l=(null==o?void 0:o.stateManager)??null,h=(null==o?void 0:o.state)??null,[g,x]=S.useState(h),j=S.useRef(null),E=S.useRef(null);S.useEffect(()=>{var e;if(!function(){if("undefined"==typeof window)return!1;try{return"1"===new URLSearchParams(window.location.search).get("kraken")}catch{return!1}}())return;if(!s||!l)return;if(E.current!==s&&(E.current=null),E.current===s)return;if(l.getState().elements.size>0)return void(E.current=s);const t=p(s);if(!t)return void(E.current=s);const n=null==(e=t.preset.overlay)?void 0:e.elements;if(n&&Array.isArray(n)&&0!==n.length)try{const e=v(t.preset,t.id);l.replaceState(e.state),E.current=s}catch(r){r instanceof Error?r.message:String(r),E.current=s}else E.current=s},[s,l]),S.useEffect(()=>{if(!s||!l)return void x(null);const e=l.getState();x(e);const t=l.subscribe(e=>{x(e)});return j.current=t,()=>{j.current&&(j.current(),j.current=null)}},[s,l]);const k=g??h,$=(()=>{var t;if(k&&k.elements.size>0)return k.elements;if((null==(t=e.overlay)?void 0:t.elements)&&Array.isArray(e.overlay.elements)&&e.overlay.elements.length>0){const t=new Map;for(const n of e.overlay.elements){const e={id:n.id,type:n.type,x:n.x,y:n.y,zIndex:n.zIndex,angle:n.angle,data:{...n.data}};t.set(e.id,e)}return t}return new Map})(),L=(()=>{var t;const n=w($,(null==k?void 0:k.zOrder)??[]);return{mode:n.length>0?"custom":(null==(t=e.overlay)?void 0:t.mode)||"none",elements:n}})(),{width:I}=i(),T=I,R=e.backgroundColor||"#000000",N="local"===e.sourceType&&a.blobUrl?a.blobUrl:t;return n.jsxs("div",{className:A,style:{width:`${T}px`,height:`${T}px`,background:R},children:[n.jsx(U,{url:N,settings:e,sourceType:e.sourceType,localKind:a.kind}),"none"!==L.mode||((null==(z=L.elements)?void 0:z.length)??0)>0?n.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"none"},children:n.jsx(b,{overlay:L,metrics:r})}):null]});var z}j(),E.init();const z=document.getElementById("root");if(!z)throw new Error("Root element #root not found");const O=k();$.createRoot(z).render(n.jsx(T.StrictMode,{children:n.jsx(L,{children:O?n.jsx(N,{}):n.jsx(I,{})})}));
